# Пример проекта с системой сборки в docker-контейнере для контроллеров Segnetics -- SMH4 (Trim5, Matrix) 

## Краткое описание

**Расчитанно на пользователей начального и выше уровня!**
Предполагается, что вы можете установить докер, гит, а так же можете зайти на контроллер по ssh. (Обычно адрес контроллер с завода 192.168.0.213)

см. так же forum.segnetics.com

Пример/заготовка проекта на языке C++/Qml с использованием библиотеки Qt, ориентирован на семество контроллеров компании Segnetics -- SMH4 (Trim5, Matrix), работающих под управлением процессора ARMv7.

Особеностью даного репозитория являестся возможность сборки проекта в docker-контейнере, без необходимости самостоятельной настройки системы для кросс-компиляции на рабочей машине, а так же нет необходимоти устанавливать и настраивать виртуальную машину с кросс-кмпиляцией в ней. Достаточно установить только docker. Ну и ещё git, для удобства ;)

**Контейнер пакует результат сборки в deb пакет, который легко установить через smlogix!**  

Все библиотеки предвариательно собранны для SMH4 и упаковываются в deb-пакет. На контроллере в процессе установки deb-пакета, приложение разворачивается в папку в корне файловой системы -- /qmlapp, там же располагаются все необходимые для работы билиотеки, модули, плагины, шрифты и т.д.   

Версия Qt -- 5.9.4

## Как пользоваться

### Windows

1. Установите docker -> https://www.docker.com
2. Установите git -> https://git-scm.com/download/win
3. Клонируйте репозиторий
> git clone https://github.com/tony-mikhailov/segnetics-smh4-qmlapp.git

3. Запустите в склонированной папке segnetics-smh4-qmlapp пакетные файлы:

**docker_build.bat** 

**docker_run.bat** 

4. Для удобства установки результат сборки будет сразу упакован в deb-пакет   **qmlapp_smh4_1.0.0.deb** 
Установите его с помошью smlogix: установка deb-пакета или скопируйте каким-либо на устройство, например по ssh: 
> scp qmlapp_smh4_1.0.0.deb root@192.168.0.213:~/

и установите с помощью команды:
> dpkg -i qmlapp_smh4_1.0.0.deb 

5. Теперь вы можете отредактировать исходные коды проекта в папке **segnetics-smh4-qmlapp/qmlapp**,
запустить **docker_run.bat**, что-бы заново собрать проект и упаковать его в deb-пакет. Тепенерь повторите пункт 4, что-бы установить результат на контроллер.

**Перед запуско возможно потребуется остановить ядро smlogix**
Для этого задите по ssh на котроллер и выполните команду:
> # /etc/init.d/logix.sh stop

### Для *NIX

1. Установите docker, git
2. Клонируем репозиторий:
> $ git clone https://github.com/tony-mikhailov/segnetics-smh4-qmlapp.git

> $ cd segnetics-smh4-qmlapp/

собираем docker-образ:
> $ docker build -t tonymikhailov/smh4_build_qt5.9.4 .

запускаем сборку приложения в докере:
> $ docker run --rm -it --mount type=bind,source="$(pwd)",target=/host tonymikhailov/smh4_build_qt5.9.4:latest /make.sh

Для удобства установки результат сборки будет сразу упакован в deb-пакет   **qmlapp_smh4_1.0.0.deb** 

Скопируйте  **qmlapp_smh4_1.0.0.deb**  по ssh:
> $ scp qmlapp_smh4_1.0.0.deb root@192.168.0.213:~/

и установите его с помощью команды:
> $ dpkg -i qmlapp_smh4_1.0.0.deb 

**Перед запуско возможно потребуется остановить ядро smlogix**
Для этого задите по ssh на котроллер и выполните команду:
> # /etc/init.d/logix.sh stop
