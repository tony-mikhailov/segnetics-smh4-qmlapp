# Пример проекта на C++/Qt/QML и среда сборки в докер-контейнере для контроллеров Segnetics -- SMH4 (Trim5, Matrix) 

## Краткое описание

### Видео
* Готовый проект на этой платформе:  https://www.youtube.com/watch?v=4VpvOpiu8Ng
* Сборка: https://www.youtube.com/watch?v=UI_ThJXpeUY&t=0s
* Запуск: https://www.youtube.com/watch?v=4O7P5Vusprg


**Расчитанно на пользователей начального и выше уровня**

Предполагается, что вы можете установить докер, гит, хотябы чуть чуть умеете пользоваться командной строкой и можете зайти на контроллер по ssh. (Обычно адрес контроллер с завода 192.168.0.213)

Пример/заготовка проекта на языке C++/Qml с использованием библиотеки Qt, ориентирован на семество контроллеров компании Segnetics -- SMH4 (Trim5, Matrix), работающих под управлением процессора ARMv7.

Особеностью данного репозитория являестся возможность сборки проекта в docker-контейнере, без необходимости самостоятельной настройки системы для кросс-компиляции на рабочей машине, а так же нет необходимоти устанавливать и настраивать виртуальную машину с кросс-компиляцией в ней. Достаточно установить только docker. Ну и ещё git, для удобства ;)

**Контейнер пакует результат сборки в deb пакет, который легко установить командой _dpkg -i qmlapp_smh4_1.0.0.deb_ или через smlogix!**

То есть, все операции по компиляции и линковке проекта проходят в докер контейнере автоматичеки, а так же все необходимые для работы исполняемые файлы, билиотеки, модули, плагины, шрифты и т.д. после сборки автоматически в докер-контейнере упаковываются в deb-пакет, который копируется на хостовую систему в папку проекта (ищите файл **qmlapp_smh4_1.0.0.deb**).   

На контроллере в процессе установки deb-пакета, приложение разворачивается в папку в корне файловой системы -- /qmlapp.   

Версия бинарной сборки Qt 5.9.4 -- armv7 hf

## Как пользоваться

### Windows

1. Установите docker -> https://www.docker.com
2. Установите git -> https://git-scm.com/download/win
3. Клонируйте репозиторий
> git clone https://github.com/tony-mikhailov/segnetics-smh4-qmlapp.git

3. Запустите в склонированной папке segnetics-smh4-qmlapp пакетные файлы:

**docker_build.bat** 

**docker_run.bat** 

4. Для удобства установки результат сборки будет сразу упакован в deb-пакет   **qmlapp_smh4_1.0.0.deb** 
Установите его с помошью smlogix: установка deb-пакета или скопируйте каким-либо на устройство, например по ssh: 
> scp qmlapp_smh4_1.0.0.deb root@192.168.0.213:~/

и установите с помощью команды:
> dpkg -i qmlapp_smh4_1.0.0.deb 

5. Теперь вы можете отредактировать исходные коды проекта в папке **segnetics-smh4-qmlapp/qmlapp**,
запустить **docker_run.bat**, что-бы заново собрать проект и упаковать его в deb-пакет. Тепенерь повторите пункт 4, что-бы установить результат на контроллер.

**Перед запуско возможно потребуется остановить ядро smlogix**
Для этого задите по ssh на котроллер и выполните команду:
> /etc/init.d/logix.sh stop

### Для *NIX

1. Установите docker, git
2. Клонируем репозиторий:
> git clone https://github.com/tony-mikhailov/segnetics-smh4-qmlapp.git

> cd segnetics-smh4-qmlapp/

собираем docker-образ:
> docker build -t tonymikhailov/smh4_build_qt5.9.4 .

запускаем сборку приложения в докере:
> docker run --rm -it --mount type=bind,source="$(pwd)",target=/host tonymikhailov/smh4_build_qt5.9.4:latest /make.sh

Для удобства установки результат сборки будет сразу упакован в deb-пакет   **qmlapp_smh4_1.0.0.deb** 

Скопируйте  **qmlapp_smh4_1.0.0.deb**  по ssh:
> scp qmlapp_smh4_1.0.0.deb root@192.168.0.213:~/

и установите его с помощью команды:
> dpkg -i qmlapp_smh4_1.0.0.deb 

**Перед запуско возможно потребуется остановить ядро smlogix**
Для этого задите по ssh на котроллер и выполните команду:
> /etc/init.d/logix.sh stop



см. так же forum.segnetics.com
